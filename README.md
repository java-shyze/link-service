# üîó Shyze Links Service

Backend-—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Å—Å—ã–ª–∫–∞–º–∏. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ Kafka –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã Shyze:

-   **shyze-frontend** ‚Äî –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ React
-   **shyze-links-service** (—ç—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π) ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∞–º–∏
-   **shyze-analytics-service** ‚Äî —Å–±–æ—Ä –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

-   –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–≤
-   CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ —Å—Å—ã–ª–∫–∞–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, —á—Ç–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ)
-   –ü–æ–∏—Å–∫ –ø–æ URL –∏ –ø—Å–µ–≤–¥–æ–Ω–∏–º–∞–º —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
-   –†–µ–¥–∏—Ä–µ–∫—Ç —Å –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ URL
-   –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –∫–ª–∏–∫–∞ –≤ Kafka –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
-   –ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
-   REST API —Å OpenAPI/Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

-   Java 21+
-   Maven 3.9+
-   Docker & Docker Compose (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
-   PostgreSQL 15+
-   Kafka/Redpanda (–¥–ª—è —Å–æ–±—ã—Ç–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd shyze-links-service

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª:

```env
LINK_DB_URL=jdbc:postgresql://localhost:5432/linkservice
LINK_DB_NAME=linkservice
LINK_DB_USERNAME=postgres
LINK_DB_PASSWORD=postgres
LINK_DB_LIQUIBASE_ENABLED=false
LINK_DB_MAXIMUM-POOL-SIZE=10
KAFKA_BOOTSTRAP_SERVERS=localhost:9092
```

### –ó–∞–ø—É—Å–∫

**–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ª–æ–∫–∞–ª—å–Ω–æ):**

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL –∏ Kafka —á–µ—Ä–µ–∑ Docker
docker compose up -d db

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
./mvnw spring-boot:run
# –°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:8080
```

**Production —Å Docker:**

```bash
# –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º justfile
just up          # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
just logs        # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
just rebuild     # –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
just down        # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Docker Compose
docker compose up -d
# –°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:8080
```

**–°–±–æ—Ä–∫–∞ JAR:**

```bash
./mvnw clean package -DskipTests
# JAR —Ñ–∞–π–ª: target/linkservice-0.0.1-SNAPSHOT.jar
```

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è             | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏                                |
| --------------------- | ----------------------------------------- |
| **Language**          | Java 21                                   |
| **Framework**         | Spring Boot 3.5.7                         |
| **Database**          | PostgreSQL 15, Spring Data JPA, Hibernate |
| **Message Broker**    | Apache Kafka, Spring Kafka                |
| **Build Tool**        | Maven 3.9                                 |
| **API Documentation** | SpringDoc OpenAPI 3, Swagger UI           |
| **Testing**           | JUnit 5, Testcontainers                   |
| **Config Management** | dotenv-java                               |
| **Containerization**  | Docker, Docker Compose                    |

## üîå API Endpoints

### Links Management API

**–ë–∞–∑–æ–≤—ã–π URL:** `/api/v1`

| –ú–µ—Ç–æ–¥    | Endpoint      | –û–ø–∏—Å–∞–Ω–∏–µ                           |
| -------- | ------------- | ---------------------------------- |
| `POST`   | `/links`      | –°–æ–∑–¥–∞—Ç—å –∫–æ—Ä–æ—Ç–∫—É—é —Å—Å—ã–ª–∫—É            |
| `GET`    | `/links`      | –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å—Å—ã–ª–∫–∏ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π) |
| `GET`    | `/links/{id}` | –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –ø–æ ID              |
| `PATCH`  | `/links/{id}` | –û–±–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫—É                    |
| `DELETE` | `/links/{id}` | –£–¥–∞–ª–∏—Ç—å —Å—Å—ã–ª–∫—É                     |

### Redirection API

| –ú–µ—Ç–æ–¥ | Endpoint   | –û–ø–∏—Å–∞–Ω–∏–µ                     |
| ----- | ---------- | ---------------------------- |
| `GET` | `/{alias}` | –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL |

### API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

-   **Swagger UI:** http://localhost:8080/docs
-   **OpenAPI JSON:** http://localhost:8080/v3/api-docs

## üìä –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kafka

–°–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ Kafka –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ:

**Topic:** `link-clicks`

**Event Schema (LinkClickEvent):**

```json
{
    "linkId": 123,
    "alias": "abc123",
    "originalUrl": "https://example.com",
    "ipAddress": "192.168.1.1",
    "userAgent": "Mozilla/5.0...",
    "referer": "https://google.com",
    "country": null,
    "city": null,
    "clickedAt": "2024-12-10T15:30:00"
}
```

–≠—Ç–∏ —Å–æ–±—ã—Ç–∏—è –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç—Å—è **shyze-analytics-service** –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

## üóÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã `links`

| –ö–æ–ª–æ–Ω–∫–∞      | –¢–∏–ø           | –û–ø–∏—Å–∞–Ω–∏–µ             |
| ------------ | ------------- | -------------------- |
| `id`         | BIGINT        | Primary Key          |
| `url`        | VARCHAR(2048) | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL     |
| `alias`      | VARCHAR(50)   | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø—Å–µ–≤–¥–æ–Ω–∏–º |
| `created_at` | TIMESTAMP     | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è        |
| `updated_at` | TIMESTAMP     | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è      |
| `visits`     | BIGINT        | –°—á–µ—Ç—á–∏–∫ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤    |

**–ò–Ω–¥–µ–∫—Å—ã:**

-   `idx_alias` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ `alias`
-   `idx_created_at` ‚Äî –∏–Ω–¥–µ–∫—Å –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏

```bash
curl -X POST http://localhost:8080/api/v1/links \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://example.com",
    "alias": "mylink"
  }'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫ —Å –ø–æ–∏—Å–∫–æ–º

```bash
curl "http://localhost:8080/api/v1/links?page=1&size=20&search=example"
```

### –†–µ–¥–∏—Ä–µ–∫—Ç

```bash
curl -L http://localhost:8080/mylink
# –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ https://example.com
```

## üîÑ Workflow

1. Frontend —Å–æ–∑–¥–∞–µ—Ç —Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ `POST /api/v1/links`
2. Links Service —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PostgreSQL
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ `/{alias}`
4. Links Service —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ Kafka
5. Analytics Service –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
6. Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É —á–µ—Ä–µ–∑ Analytics Service API
